{% extends 'gerente/base_gerente.html' %}
{% block title %}Painel da Loja{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header">Gerar Relatório de Cadastros da Loja</div>
            <div class="card-body">
                <form method="GET" action="{{ url_for('routes.gerar_relatorio_gerente_pdf') }}" target="_blank">
                    <div class="row align-items-end g-2">
                        <div class="col-md-5"><label class="form-label">Data de Início</label><input type="date" name="data_inicio" class="form-control" required></div>
                        <div class="col-md-5"><label class="form-label">Data de Fim</label><input type="date" name="data_fim" class="form-control" required></div>
                        <div class="col-md-2"><button type="submit" class="btn btn-success w-100">Gerar</button></div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-12 mb-4">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Produtos PARA REBAIXA</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nome do Produto</th>
                                <th>Setor</th>
                                <th>Validade</th>
                                <th>Dias Rest.</th>
                                <th>Cadastrado Por</th>
                                <th>Alterar Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for produto in produtos_para_rebaixa %}
                                {% set dias_restantes = (produto.validade - now.date()).days %}
                                <tr class="{% if dias_restantes < 5 %}table-danger{% elif dias_restantes <= 10 %}table-warning{% endif %}">
                                    <td>{{ produto.nome_produto }}</td>
                                    <td>{{ produto.setor.nome }}</td>
                                    <td>{{ produto.validade.strftime('%d/%m/%Y') }}</td>
                                    <td>{{ dias_restantes }}</td>
                                    <td>{{ produto.criado_por.nome_display }}</td>
                                    <td>
                                        <form method="POST" action="{{ url_for('routes.alterar_status', produto_id=produto.id) }}" onsubmit="return confirm('Tem certeza que deseja alterar o status deste item?');">
                                            <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                                <option value="Para Rebaixa" selected>Para Rebaixa</option>
                                                <option value="Em Rebaixa">Em Rebaixa</option>
                                            </select>
                                        </form>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">Nenhum produto aguardando rebaixa.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Produtos EM REBAIXA</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                         <thead>
                            <tr>
                                <th>Nome do Produto</th>
                                <th>Setor</th>
                                <th>Validade</th>
                                <th>Dias Rest.</th>
                                <th>Cadastrado Por</th>
                                <th>Alterar Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for produto in produtos_em_rebaixa %}
                                {% set dias_restantes = (produto.validade - now.date()).days %}
                                <tr class="table-success">
                                    <td>{{ produto.nome_produto }}</td>
                                    <td>{{ produto.setor.nome }}</td>
                                    <td>{{ produto.validade.strftime('%d/%m/%Y') }}</td>
                                    <td>{{ dias_restantes }}</td>
                                    <td>{{ produto.criado_por.nome_display }}</td>
                                    <td>
                                        <form method="POST" action="{{ url_for('routes.alterar_status', produto_id=produto.id) }}" onsubmit="return confirm('Tem certeza que deseja alterar o status deste item?');">
                                            <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                                <option value="Para Rebaixa">Para Rebaixa</option>
                                                <option value="Em Rebaixa" selected>Em Rebaixa</option>
                                            </select>
                                        </form>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">Nenhum produto em rebaixa no momento.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}